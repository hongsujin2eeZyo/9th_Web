1. useMutationì´ë€?

ì •ì˜

ì„œë²„ì— â€œë³€ê²½ ìš”ì²­(POST/PUT/PATCH/DELETE)â€ì„ ë³´ë‚´ê³ , ê·¸ ì „í›„ ìƒíƒœë¥¼ ê´€ë¦¬í•´ì£¼ëŠ” React Query í›…

ì˜ˆ: í•  ì¼ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ / ì¢‹ì•„ìš” í† ê¸€ / í”„ë¡œí•„ ìˆ˜ì • ë“±

ì™œ í•„ìš”í•œê°€? (ì„œë²„ ìƒíƒœ ê´€ë¦¬ ì—†ë˜ ì‹œì ˆì˜ ë¹„ê·¹)

ì˜ˆë¥¼ ë“¤ì–´ í•  ì¼ì´ 10ê°œì¼ ë•Œ:

í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•  ì¼ ì¶”ê°€ ìš”ì²­(POST) â†’ ì„œë²„ì—ì„œëŠ” 11ê°œê°€ ë¨ âœ…

í™”ë©´ì€ ì—¬ì „íˆ ì˜ˆì „ 10ê°œ ëª©ë¡ì„ ë³´ì—¬ì¤Œ âŒ

ë§¤ë²ˆ ê°œë°œìê°€ ì§ì ‘ fetchTodos() ê°™ì€ ê±¸ ë‹¤ì‹œ í˜¸ì¶œí•´ì•¼ í•¨ â†’ ì¤‘ë³µ ì½”ë“œ + ë²„ê·¸ ìœ„í—˜

â†’ useMutation + invalidateQueriesë¥¼ ì“°ë©´
â€œë³€ê²½ ì‘ì—… ì„±ê³µ â†’ ê´€ë ¨ ëª©ë¡ ì¿¼ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°â€ íŒ¨í„´ì„ í‘œì¤€í™”í•  ìˆ˜ ìˆìŒ.

2. useMutationì˜ í•µì‹¬ ê°œë… & ì˜µì…˜
2-1. ê°€ì¥ ì¤‘ìš”í•œ ì˜µì…˜

mutationFn

ì‹¤ì œë¡œ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜

ì˜ˆ: createTodo, deleteTodo, toggleLike ë“±

const create = useMutation({
  mutationKey: ['createTodo'],
  mutationFn: createTodo,
  onSuccess: () => qc.invalidateQueries({ queryKey: ['todos'] }),
});

2-2. ë¼ì´í”„ì‚¬ì´í´ ì˜µì…˜ (ë³€ê²½ ì „/ì¤‘/í›„ ì œì–´)
ì˜µì…˜	ì‹¤í–‰ ì‹œì 	ì£¼ ìš©ë„
onMutate	ìš”ì²­ ë³´ë‚´ê¸° ì§ì „	ë‚™ê´€ì  ì—…ë°ì´íŠ¸, ì´ì „ ìƒíƒœ ì €ì¥(ë¡¤ë°±ìš©)
onSuccess	ìš”ì²­ ì„±ê³µ ì§í›„	ìºì‹œ ë™ê¸°í™”, invalidateQueries ë“±
onError	ìš”ì²­ ì‹¤íŒ¨ ì‹œ	ë¡¤ë°±, ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
onSettled	ì„±ê³µ/ì‹¤íŒ¨ì™€ ê´€ê³„ì—†ì´ ëª¨ë“  ì‘ì—… ì¢…ë£Œ í›„	ë§ˆì§€ë§‰ ì •ë¦¬, ìµœì¢…ì ìœ¼ë¡œ ì¿¼ë¦¬ ë¬´íš¨í™”/ë™ê¸°í™”
2-3. ê¸°íƒ€ ì„¤ì • ì˜µì…˜
ì˜µì…˜	ì—­í• 
retry	ì‹¤íŒ¨ ì‹œ ëª‡ ë²ˆê¹Œì§€ ìë™ ì¬ì‹œë„í• ì§€
retryDelay	ì¬ì‹œë„ ì‚¬ì´ì˜ ë”œë ˆì´ ì‹œê°„
throwOnError	ì—ëŸ¬ë¥¼ ë‚´ë¶€ì—ì„œ ì¡ì§€ ì•Šê³  ë°”ê¹¥ìœ¼ë¡œ ë˜ì§ˆì§€ ì—¬ë¶€
meta	ë¡œê·¸/ë””ë²„ê¹…ìš© ë©”íƒ€ë°ì´í„°ë¥¼ ë¶™ì¼ ë•Œ ì‚¬ìš©
3. ë‚™ê´€ì  ì—…ë°ì´íŠ¸(Optimistic Update)ë€?

ì •ì˜

ì„œë²„ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³ 
â€œì–´ì°¨í”¼ ì„±ê³µí•  ê±°ì•¼â€ ë¼ê³  ê°€ì •í•˜ê³ 
UIë¥¼ ë¨¼ì € ì—…ë°ì´íŠ¸í•œ í›„,
ë‚˜ì¤‘ì— ì„œë²„ ê²°ê³¼ì— ë”°ë¼ ìœ ì§€/ë¡¤ë°±í•˜ëŠ” íŒ¨í„´.

í•µì‹¬ ì•„ì´ë””ì–´

ë²„íŠ¼ í´ë¦­ â†’ ê³§ë°”ë¡œ í™”ë©´ì— ë°˜ì˜

ì„œë²„ëŠ” ê·¸ ë’¤ì—ì„œ â€œë‚˜ì¤‘ì—â€ í™•ì¸

ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ë˜ëŒë¦¼(ë¡¤ë°±)

ì¥ì  ğŸ‘

ì¦‰ê°ì ì¸ í”¼ë“œë°± â†’ ì•±ì´ â€œë§¤ìš° ë¹ ë¥´ê²Œâ€ ëŠê»´ì§

ë„¤íŠ¸ì›Œí¬ê°€ ëŠë ¤ë„ ì‚¬ìš©ìëŠ” ê±°ì˜ ì²´ê° ëª» í•¨

ì¢‹ì•„ìš”/ë¶ë§ˆí¬/í† ê¸€ ê°™ì€ ê°€ë³ê³  ìì£¼ ì“°ëŠ” ì•¡ì…˜ì— íŠ¹íˆ ìœ ë¦¬

ë‹¨ì /ì£¼ì˜ì  ğŸ˜µ

ë¡¤ë°± ë¡œì§ì„ ë°˜ë“œì‹œ êµ¬í˜„í•´ì•¼ í•¨

ì´ì „ ìƒíƒœ ì €ì¥, ì‹¤íŒ¨ ì‹œ ë³µêµ¬

ì ê¹ ë™ì•ˆ ì„œë²„ ìƒíƒœì™€ í´ë¼ì´ì–¸íŠ¸ UIê°€ ë¶ˆì¼ì¹˜í•  ìˆ˜ ìˆìŒ

ê²°ì œ/ì†¡ê¸ˆ/ì¬ê³  ë“± ì •í•©ì„± ì¤‘ìš”í•œ ë„ë©”ì¸ì—ëŠ” ìœ„í—˜

4. ë‚™ê´€ì  ì—…ë°ì´íŠ¸ê°€ íš¨ìœ¨ì ì¸ ìƒí™© / í”¼í•´ì•¼ í•  ìƒí™©
íš¨ìœ¨ì ì¸ ìƒí™© âœ…

â€œUXì—ì„œ ì¦‰ê°ì ì¸ ë°˜ì‘ì´ ì¤‘ìš”í•œë°, ì‹¤íŒ¨í•´ë„ ì¹˜ëª…ì ì´ì§€ ì•Šì€ ì‘ì—…â€

ì˜ˆì‹œ

ì¢‹ì•„ìš” / ë¶ë§ˆí¬ / íŒ”ë¡œìš° í† ê¸€

ëŒ“ê¸€, ì±„íŒ… ë©”ì‹œì§€ ì„ì‹œ ì¶”ê°€

ë§ˆì´í˜ì´ì§€ ê°œì¸ ì„¤ì • ë³€ê²½ (í…Œë§ˆ, ì–¸ì–´ ë“±)

ë„¤íŠ¸ì›Œí¬ê°€ ë¶ˆì•ˆì •í•œ í™˜ê²½ì—ì„œ â€œëˆŒë €ì„ ë•Œ ë°”ë¡œ ë°˜ì‘â€ì´ ì¤‘ìš”í•œ ê²½ìš°

í”¼í•´ì•¼ í•˜ëŠ” ìƒí™© âŒ

â€œì‹¤íŒ¨ ì‹œ í”¼í•´ê°€ í¬ê±°ë‚˜, ë°ì´í„° ì •í•©ì„±ì´ ë§¤ìš° ì¤‘ìš”í•œ ì‘ì—…â€

ì˜ˆì‹œ

ê²°ì œ, ì†¡ê¸ˆ, ê³„ì¢Œ ì”ì•¡ ë³€ê²½

í‹°ì¼“ ë°œê¶Œ, ì¢Œì„ ì˜ˆì•½, ì¬ê³  ìˆ˜ëŸ‰ ë³€ê²½

ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— í¸ì§‘í•˜ëŠ” í˜‘ì—… ë¬¸ì„œ

ë˜ëŒë¦´ ìˆ˜ ì—†ëŠ” ì‚¬ì´ë“œ ì´í™íŠ¸

ì´ë©”ì¼ ë°œì†¡, ì•Œë¦¼ ë°œì†¡, ì¹´ì¹´ì˜¤í†¡ ì „ì†¡ ë“±

5. TanStack Queryì—ì„œì˜ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ íë¦„

ì „ì²´ í”Œë¡œìš°: onMutate â†’ (mutate) â†’ onError â†’ onSettled

onMutate(variables)

ì„œë²„ ìš”ì²­ ì „ì— í˜¸ì¶œ

í•˜ëŠ” ì¼:

ê´€ë ¨ ì¿¼ë¦¬ ì·¨ì†Œ (cancelQueries)

í˜„ì¬ ìºì‹œ ìƒíƒœ ë°±ì—… (previous)

setQueryDataë¡œ UIë¥¼ ë¨¼ì € ë°”ê¿ˆ (optimistic update)

return { previous, ... } í˜•íƒœë¡œ **ë¡¤ë°±ìš© ë°ì´í„°(context)**ë¥¼ ë°˜í™˜

mutate (ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­)

ì˜ˆ: await api.post('/todos', variables)

onError(error, variables, context)

ì„œë²„ ìš”ì²­ ì‹¤íŒ¨ ì‹œ í˜¸ì¶œ

context.previousë¥¼ ì´ìš©í•´ ìºì‹œ ë¡¤ë°±

ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ í† ìŠ¤íŠ¸/ì•Œë¦¼

onSettled(data, error, variables, context)

ì„±ê³µ/ì‹¤íŒ¨ ìƒê´€ì—†ì´ ë§ˆì§€ë§‰ì— í•­ìƒ í˜¸ì¶œ

ë³´í†µ:

invalidateQueriesë¡œ ìµœì¢… ì„œë²„ ìƒíƒœì™€ ë™ê¸°í™”

í˜¹ì€ ì„œë²„ì—ì„œ ë°›ì€ dataë¡œ ìºì‹œë¥¼ ì •êµí•˜ê²Œ ì—…ë°ì´íŠ¸

6. ToDo â€œìƒì„±â€ & â€œì¢‹ì•„ìš” í† ê¸€â€ ë¡¤ë°± ì „ëµ (ìš”ì•½ë³¸)
6-1. ToDo ìƒì„± + ë‚™ê´€ì  ì—…ë°ì´íŠ¸

onMutate(newTodo)

ì„ì‹œ ID ë°œê¸‰: tempId = 'temp-' + uuid() (ë˜ëŠ” ìŒìˆ˜ ID)

cancelQueries(['todos'])

previous = getQueryData(['todos'])

setQueryData(['todos'], old => [ { id: tempId, ...newTodo, pending: true }, ...old ])

return { previous, tempId }

mutate (POST /todos)

ì„œë²„ì— ìƒˆ todo ìƒì„± ìš”ì²­

í•„ìš” ì‹œ idempotency-keyë¥¼ ê°™ì´ ë³´ë‚´ ì¤‘ë³µ ìƒì„± ë°©ì§€

onError(err, newTodo, context)

ë‘ ê°€ì§€ ë°©ì‹ ì¤‘ í•˜ë‚˜:

ì „ì²´ í†µì§¸ë¡œ ë¡¤ë°±: setQueryData(['todos'], context.previous)

ë˜ëŠ” ì„ì‹œ í•­ëª©ë§Œ ì œê±°:

setQueryData(['todos'], old => old.filter(item => item.id !== context.tempId))

ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ì•ˆë‚´ + ì¬ì‹œë„ ë²„íŠ¼ ë“±

onSuccess(serverTodo, variables, context)

setQueryData(['todos'], old => old.map(it => it.id === context.tempId ? serverTodo : it))

â†’ ì„ì‹œ ID â†’ ì„œë²„ì˜ ì‹¤ì œ IDë¡œ êµì²´

onSettled

í•„ìš”í•˜ë‹¤ë©´ invalidateQueries(['todos'])ë¡œ ìµœì¢… ë™ê¸°í™”

6-2. â€œì¢‹ì•„ìš” í† ê¸€â€ + ë‚™ê´€ì  ì—…ë°ì´íŠ¸

íŒ¨í„´ì€ ë¹„ìŠ·í•˜ì§€ë§Œ, ìƒì„±ì´ ì•„ë‹ˆë¼ í† ê¸€ì´ë¯€ë¡œ ID êµì²´ë³´ë‹¤ëŠ” ìƒíƒœ í”Œë¦½ì— ì´ˆì 

onMutate({ postId })

cancelQueries(['posts', postId])

previous = getQueryData(['posts', postId])

setQueryData(['posts', postId], old => ({ ...old, liked: !old.liked, likeCount: old.likeCount + (old.liked ? -1 : 1) }))

return { previous }

mutate (POST /posts/:id/like-toggle)

onError(err, vars, context)

setQueryData(['posts', vars.postId], context.previous)ë¡œ ë¡¤ë°±

onSettled

invalidateQueries(['posts', vars.postId]) ë˜ëŠ” ë¦¬ìŠ¤íŠ¸ ì¿¼ë¦¬ê¹Œì§€ ë¬´íš¨í™”í•˜ì—¬ ì„œë²„ì™€ ë‹¤ì‹œ ë§ì¶¤